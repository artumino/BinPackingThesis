% A LaTeX template for EXECUTIVE SUMMARY of the MSc Thesis submissions to 
% Politecnico di Milano (PoliMi) - School of Industrial and Information Engineering
%
% S. Bonetti, A. Gruttadauria, G. Mescolini, A. Zingaro
% e-mail: template-tesi-ingind@polimi.it
%
% Last Revision: October 2021
%
% Copyright 2021 Politecnico di Milano, Italy. NC-BY

\documentclass[11pt,a4paper,twocolumn]{article}

%------------------------------------------------------------------------------
%	REQUIRED PACKAGES AND  CONFIGURATIONS
%------------------------------------------------------------------------------
% PACKAGES FOR TITLES
\usepackage{titlesec}
\usepackage{color}

% PACKAGES FOR LANGUAGE AND FONT
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[T1]{fontenc} % Font encoding

% PACKAGES FOR IMAGES
\usepackage{graphicx}
\usepackage{tikz} % A package for high-quality hand-made figures.
\usetikzlibrary{}
\graphicspath{{./Images/}} % Directory of the images
\usepackage{eso-pic} % For the background picture on the title page
\usepackage{subfig} % Numbered and caption subfigures using \subfloat
\usepackage{caption} % Coloured captions
\usepackage{transparent}

% STANDARD MATH PACKAGES
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{bm}
\usepackage[overload]{empheq}  % For braced-style systems of equations

% PACKAGES FOR TABLES
\usepackage{tabularx}
\usepackage{longtable} % tables that can span several pages
\usepackage{colortbl}

% PACKAGES FOR ALGORITHMS (PSEUDO-CODE)
\usepackage{algorithm}
\usepackage{algorithmic}

% PACKAGES FOR REFERENCES & BIBLIOGRAPHY
\usepackage[colorlinks=true,linkcolor=black,anchorcolor=black,citecolor=black,filecolor=black,menucolor=black,runcolor=black,urlcolor=black]{hyperref} % Adds clickable links at references
\usepackage{cleveref}
\usepackage[authoryear, square, numbers, sort&compress]{natbib} % Square brackets, citing references with numbers, citations sorted by appearance in the text and compressed
\bibliographystyle{apalike} % You may use a different style adapted to your field

% PACKAGES FOR THE APPENDIX
\usepackage{appendix}

% PACKAGES FOR ITEMIZE & ENUMERATES 
\usepackage{enumitem}

% OTHER PACKAGES
\usepackage{amsthm,thmtools,xcolor} % Coloured "Theorem"
\usepackage{comment} % Comment part of code
\usepackage{fancyhdr} % Fancy headers and footers
\usepackage{lipsum} % Insert dummy text
\usepackage{tcolorbox} % Create coloured boxes (e.g. the one for the key-words)
\usepackage{stfloats} % Correct position of the tables

%-------------------------------------------------------------------------
%	NEW COMMANDS DEFINED
%-------------------------------------------------------------------------
% EXAMPLES OF NEW COMMANDS -> here you see how to define new commands
\newcommand{\bea}{\begin{eqnarray}} % Shortcut for equation arrays
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\e}[1]{\times 10^{#1}}  % Powers of 10 notation
\newcommand{\mathbbm}[1]{\text{\usefont{U}{bbm}{m}{n}#1}} % From mathbbm.sty
\newcommand{\pdev}[2]{\frac{\partial#1}{\partial#2}}
% NB: you can also override some existing commands with the keyword \renewcommand

%----------------------------------------------------------------------------
%	ADD YOUR PACKAGES (be careful of package interaction)
%----------------------------------------------------------------------------
\usepackage{adjustbox}
\usepackage{enumitem}

%----------------------------------------------------------------------------
%	ADD YOUR DEFINITIONS AND COMMANDS (be careful of existing commands)
%----------------------------------------------------------------------------


% Do not change Configuration_files/config.tex file unless you really know what you are doing. 
% This file ends the configuration procedures (e.g. customizing commands, definition of new commands)
\input{Executive_Configuration_files/config}

% Insert here the info that will be displayed into your Title page 
% -> title of your work
\renewcommand{\title}{Three-dimensional bin packing with vertical support}
% -> author name and surname
\renewcommand{\author}{Jacopo LibÃ¨}
% -> MSc course
\newcommand{\course}{Computer Science and Engineering - Ingegneria Informatica}
% -> advisor name and surname
\newcommand{\advisor}{Prof. Ola Jabali}
% IF AND ONLY IF you need to modify the co-supervisors you also have to modify the file Configuration_files/title_page.tex (ONLY where it is marked)
\newcommand{\firstcoadvisor}{Davide Croci} % insert if any otherwise comment
%\newcommand{\secondcoadvisor}{Name Surname} % insert if any otherwise comment
% -> academic year
\newcommand{\YEAR}{2021-2022}

%-------------------------------------------------------------------------
%	BEGIN OF YOUR DOCUMENT
%-------------------------------------------------------------------------
\begin{document}

%-----------------------------------------------------------------------------
% TITLE PAGE
%-----------------------------------------------------------------------------
% Do not change Configuration_files/TitlePage.tex (Modify it IF AND ONLY IF you need to add or delete the Co-advisors)
% This file creates the Title Page of the document
\input{Executive_Configuration_files/title_page}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%     THESIS MAIN TEXT     %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%% \section{Guidelines}
%% \label{sec:guidelines}
%% 
%% The Executive Summary is a critical overview of your thesis
%% with a focus on the main achievements that have emerged from your research.
%% 
%% The Executive Summary should be organized in sections/paragraphs
%% in order to better highlight the major points of your work.
%% The length should range from four to six pages depending on the length of the thesis manuscript.
%% Keep the Executive Summary concise enough to be effective but long enough to allow it to be complete.
%% It should be written after completing the thesis manuscript as a stand-alone independent document
%% of sufficient clarity and detail to ensure that the reader can figure out the overall objectives,
%% the methodology employed and the results/impact of your research.
%% 
%% In writing the Executive Summary, keep in mind that it is not an abstract, it is not a preface,
%% and it is not a random collection of highlights.
%% With a few exceptions, do not simply cut and paste whole sections or paragraphs of the thesis manuscript
%% into a disorganized and cluttered Executive Summary.
%% You should reorganize information to be informative as well as concise.
%% 
%% The Executive Summary could contain a few important equations related to your work.
%% It could also include the most relevant figures and tables taken or elaborated from the thesis manuscript.
%% 
%% You should also include in the Executive Summary the very essential bibliography of your study.
%% The number of selected references should range from three to five depending on the type of work.
%% 
%% The Executive Summary should contain a final section reporting the main conclusions drawn from your research.

%-----------------------------------------------------------------------------
% INTRODUCTION
%-----------------------------------------------------------------------------
\section{Introduction}
\label{sec:introduction}

Recent progress in the digitalization of industrial processes led to a rise in studies on the Three-Dimensional Bin Packing Problem (3D-BPP).
The problem consists in packing a set of items in the minimum number of bins without any overlap.
When considering real-world settings, the addition of new practical constraints is required.
Previous studies in other fields related to container loading and pallet loading have shown that static stability of the bins is a crucial aspect to consider (\cite{BORTFELDT20131}).
In this thesis, we address a version of the bin packing problem stemming from a real case study of mixed-case palletization: the Three-Dimensional Bin Packing Problem with Vertical Support (3D-BPPVS).
We extend the standard formulation of the bin packing problem by ensuring that all items that are packed inside a bin will not fall, and we refer to this property as the vertical support.
Vertical stability is usually ensured between horizontal or vertical slices of items as a constraint on the minimum amount of area which rests on other items (e.g., \cite{GZARA20201062,paquay2016mixed}).
Each item can also be rotated along its vertical axis by 90 degrees.

Our research stems from the case study of a logistics company in northern Italy.
The company manages large warehouses where automated lines bring boxes to different packing stations, and then they are loaded onto pallets of standard size.
Since the company is dealing directly with customers' orders, boxes have very different sizes and are usually packed in smaller quantities.
Moreover, the assortment of items to pack is strongly heterogeneous which makes the use of layered approaches have sub-optimal results.
During the palletization, levels of already packed items are wrapped to ensure better overall stability of the pallet.
This wrapping procedure requires that the amount of unused space between items is minimal.
The company measures this property with a metric called cage ratio.
Cage ratio is the ratio between the volume of the packed items inside a bin and the volume of the cuboid which surrounds them, the cage.
The cage has the same base as the bin and height equal to the highest packed item inside the bin.
Current commercial solutions employed by the company have solutions with around $60\%$ cage ratio, and a target of $70\%$ was set as a benchmark for our work.
A visual representation of the cage ratio is shown in \cref{fig:cage_ratio}.

\begin{figure}[h]
    \resizebox{\columnwidth}{!}{%
    \input{Images/cage_ratio_big}
    }
    \caption{Cage ratio of two different bin configurations}
    \label{fig:cage_ratio}
\end{figure}

\section{Literature Review}
The 3D-BPP is the generalization of the one-dimensional bin packing problem which is NP-Hard (\cite{martello2000three}).
Exact methods can only solve small instances of the problem which means that most solutions proposed in the literature are heuristics.
Heuristics for the 3D-BPP are designed to solve the standard problem and don't take into account practical constraints.
\cite{martello2000three} provided a set of benchmark instances for 3D-BPP heuristics, and an exact method based on a two-level branch-and-bound algorithm.
Their method used a staircase placement strategy, where a series of corner points were identified as possible placement points to evaluate.
The method was later extended in \cite{crainic2008extreme} to find new niches previously ignored by the introduction of Extreme Points.
\cite{gonccalves2013biased} introduced a biased random-key genetic algorithm (BRKGA) which is one of the best performing heuristics on the benchmark instances of \cite{martello2000three}.
The algorithm was later modified with variable neighborhood descent variation presented in \cite{zudio2018brkga} which improved the number of generations needed to find high-quality results.

The concept of vertical support received most of its contribution from the literature of Container Loading Problems (CLP) and Pallet Loading Problems (PLP).
As noted in \cite{BORTFELDT20131}, static stability is usually implicitly enforced as a consequence of load compactness, or explicitly guaranteed by using filler material in a post-processing step.
Most heuristics for CLPS and PLPs try to build dense layers composed of similar items that they stack, reducing the problem to a one-dimensional bin packing problem.
Layers are filtered based on the fill-rate and when they are below a certain threshold they are discarded (e.g., \cite{elhedhli2019three, Alonso2020}).
This means that when no new layer can be built, new bins are opened, simpler placement methods are used to pack the remaining items or filler material is used to complete the layers.
Other more recent methods in the PLPs literature ensure support explicitly as a post-processing step when spacing layers relative to eachother (e.g., \cite{GZARA20201062}).

Our solution to the problem fills the gap in the research by finding solutions to the 3D-BPPVS without explicitly building layers, and without the use of filler material.

\section{Proposed Solution}

Based on other publications from the literature and our case study partner's insights we define the property of vertical support.
Given a support area threshold $\alpha_s$ and a maximum vertical gap below which an item can be considered as effectively supporting another one $\beta_s$. We define an item as supported if one of the following conditions holds
\begin{enumerate}[label={\textbf{Condition \arabic*}.},ref={\arabic*},leftmargin=*]
    \item the sum of the overlap area over the XY-plane with every other item on which it is resting is greater than $\alpha_s$ times its base area. (area support) \label{support:area_support}
    \item the number of its corners resting on another item is greater or equal to 3, and condition \ref{support:area_support} holds with a threshold $\alpha^\prime_s$ where $\alpha^\prime_s < \alpha_s$. (vertex support) \label{support:vertex_support}
\end{enumerate}
A visual representation of the conditions \ref{support:area_support} and \ref{support:vertex_support} of support is illustrated in \cref{fig:support}.

\begin{figure}[h]
    \resizebox{\columnwidth}{!}{%
    \input{Images/support_big}
    }
    \caption{Representation of an item with conditions \ref{support:area_support} and \ref{support:vertex_support} of vertical support given $\alpha_s = 0.5, \beta_s$}
    \label{fig:support}
\end{figure}

We propose an heuristic that combines a constructive heuristic with a beam-search algorithm.
The main idea of the heuristic is to build solutions to the 3D-BPPVS without explicitly building layes, and without the use of filling material.
The constructive heuristic is designed to solve a single-bin bin packing problem with vertical support, while the beam-search expands the heuristic's solutions by exploring different sequences of item placements.
A conceptual representation of the heuristic steps can be seen in \cref{fig:heur_scheme}.
\begin{figure}[h]
    \resizebox{\columnwidth}{!}{%
    \input{Images/heur_scheme}
    }
    \caption{Conceptual representation of the proposed heuristic}
    \label{fig:heur_scheme}
\end{figure}


Since our heuristic is constructive in nature, we start from an empty solution and iteratively find new partial solutions by packing new items or opening new bins.
To represent a partial solution, we define a structure containing all the placed items and opened of bins.
The beam-search algorithm starts from the empty solution and iteratively explores a limited number of $k$ new partial solutions. 
These partial solutions are generated by using an underlying single-bin packing constructive heuristic to determine a set of possible insertion to make in opened bins.
If no insertions are possible, a new bin is opened.
Since we only evaluate insertions that increase the number of packed items, this leads to a complete solution of the problem where no item is left unpacked.
To limit the number of partial solutions to consider at each iteration, we define a ranking between them which uses metrics directly related to the objective function of our problem.
We rank these solutions to minimize the number of bins opened, and then to maximize the amount of volume packed and the average cage ratio obtained.
At the end of each iteration only the $k$ best partial solutions are kept. 
Since different sequences of placements can lead to the same partial solution, we proposed a duplicate removal procedure based on an hashing function to filter duplicate solutions between iterations.

In order to generate solutions that have vertical support we ensure that each insertion considered will mantain the property of vertical support.
To generate new possible insertion, we use a constructive heuristic that operates at the bin level called Support Planes (SP).
Support Planes is designed to solve the single-bin bin packing problem.
It operates by dividing the space inside the bin into planes, generated by the top of items previously inserted. 
These planes, called support planes, contain references to items that will be able to offer support to others placed on the plane.
Each support plane also contains a list of the items that are intersecting the plane, which would be obstacles to items placed on it.
In order to generate a series of feasible insertions, we evaluate each plane inside a bin starting from the lowest one.
To reduce the number of possible insertions to consider, we group unpacked items based on their shape thanks to a hashing of each item's dimensions.
We propose two configurations of SP which evaluate insertions of one item at a time (PS), or of the maximum number of items per type that fit a plane (PM).
For each grouping we then calculate which is the first plane, starting from the lowest one, where we can insert items with that shape without overlaps and without violating vertical support (considering possible rotations).
We use a modified version of the two-dimensional Extreme Points algorithm proposed in \cite{crainic2008extreme} designed to account for the conditions of vertical support (by using the sets of support and obstacle items in each plane).
In order to do fast overlap checks we also use axis-align bounding box trees which have already been used in other fields for fast collision checks (\cite{bergen1997efficient}).
Similarly to the ranking of partial solutions of the problem, each possible insertion per group of items is then ranked to facilitate the generation of even surfaces in the solution and to avoid over satisying the support constraint, which could lead to unbalanced bins as reported in \cite{elhedhli2019three}.

%-----------------------------------------------------------------------------
% CONCLUSION
%-----------------------------------------------------------------------------
\section{Conclusions}
In this thesis, we presented an heuristic for the Three-Dimensional Bin Packing Problem with Vertical Support.
We modified the two-dimensional Extreme Points algorithm of \citet{crainic2008extreme} to consider vertical support.
We then used this modified algorithm in a constructive heuristic which builds solutions to the single bin three-dimensional bin packing problem by filling planes, generated based on the previously inserted items.
Finally, we introduced a beam-search algorithm which evaluates different sequences of item placements by using our proposed constructive heuristic, and removes duplicate solutions at each iteration.

Our heuristic achieved an average gap of $5.37\%$ against the best solutions provided by other heuristics, however we were able to solve the same problem in a fraction of their computational time.
We consider this as a great result since it states that our algorithm is competitive also in the realm of 3D-BPP without support.
We generated a data set of problem instances based on real-world products from our case study, and we used them to evaluate our heuristic.
In most configurations, our solutions exceeded the target metric of $70\%$ cage ratio, with some configurations having a negligible execution time.
In \cref{results:usecase_summary} we report the average execution time (\textit{TT}), bin used (B), and cage ratio (\textit{CR}) across all our 100 case study instances for each configuration of our heuristic. 
Different placement modes are marked as PS (single placement) and PM (multiple items per placements), and each row represent a different value of $k$ states considered in the beam-search.
In \cref{exp:usecase_tradeoff} we analyze the tradeoff between running times and cage ratio obtained by each configuration of the heuristic.
We list the difference between the average running time of each configuration (\textit{TT}) and the best average running time (\textit{TT*}) together with the difference between best average cage ratio (\textit{CR*}) and the average cage ratio obtained by each configuration (\textit{CR}).
We identified that for our partner needs a good configuration consists in using the PM placement mode with $k \in {20, 50}$.

Further research could introduce new practical constraints considered in the literature like family groupings, load-bearing, and compatibilities between items.
Improvement heuristics could also be adapted to account for the support constraint like, for example, space defragmentation techniques introduced by \cite{ZHU2012452}.

\input{tests/use_case_avg_global}
\input{tests/use_case_tradeoff_summary}

\begin{figure}
    \centering
    \includegraphics[width = \columnwidth]{tests/usecase/instance-82_k200.PNG}
    \caption{Solution to Instance 82 from case study tests}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width = \columnwidth]{tests/usecase/instance-66_bin1_k200.PNG}
    \caption{Solution to Instance 66, Bin 1 from case study tests}
\end{figure}

%---------------------------------------------------------------------------
%  ACKNOWLEDGEMENTS 
%---------------------------------------------------------------------------
\section{Acknowledgements}
My deepest gratitude goes to my supervisors, Prof. Ola Jabali and Dr. Davide Croci for their insights and support.
This work wouldn't have been possible without them.\\
\\%TODO: non solo thanks
Thanks to the team at ERMES-X s.r.l who provided me with the case study and the data used for our experiments.\\
\\
Many thanks to my family, my mom Patrizia, my father Severino, and my sister Giulia for always supporting me during this journey.
Last but not least, thanks to my colleagues Alberto, Edoardo, Mirko, and Kevin, that brightened every day at the university.

%---------------------------------------------------------------------------
%  BIBLIOGRAPHY
%---------------------------------------------------------------------------
% Remember to insert here only the essential bibliography of your work
\setcitestyle{numbers} % set the citation style to ``numbers''.
\bibliography{literature.bib} % automatically inserted and ordered with this command 

\end{document}